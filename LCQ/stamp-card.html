<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LCQ ìŠ¤íƒ¬í”„ ì¹´ë“œ â€” 12ê°„ì§€(ì „í™”ë²ˆí˜¸ ì—°ë™)</title>
  <meta name="description" content="ë¼ì˜¤ì¶©ì¹­í› ê¶ˆ(LCQ) ë§¤ì¥ìš© ìŠ¤íƒ¬í”„ ì¹´ë“œ â€” ê³ ê° ì „í™”ë²ˆí˜¸ë¡œ ë§¤í•‘, 12ê°„ì§€(ì‹­ì´ì§€ì‹ ) 12ì¹¸ ì ë¦½ êµ¬ì¡°, ë¡œì»¬ ì €ì¥/ê³µìœ /ì¸ì‡„ ì§€ì›." />
  <style>
    :root{
      --bg:#f8fafc; --paper:#ffffff; --text:#1a1a1a; --muted:#6b7280;
      --line:#e5e7eb; --brand:#b3001b; --gold:#cfae5c; --ok:#16a34a; --warn:#d97706;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Noto Sans KR,Helvetica,Arial,sans-serif;line-height:1.5}

    header{position:sticky;top:0;z-index:10;background:rgba(255,255,255,.9);backdrop-filter:saturate(130%) blur(8px);border-bottom:1px solid var(--line)}
    .head{max-width:980px;margin:0 auto;padding:14px 16px;display:flex;align-items:center;gap:12px}
    .badge{width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,var(--brand),#7c0011);display:grid;place-items:center;color:#fff;font-weight:800}
    .title{font-weight:800}
    .sub{font-size:12px;color:var(--muted)}

    main{max-width:980px;margin:0 auto;padding:20px 16px 80px}
    .card{background:var(--paper);border:1px solid var(--line);border-radius:16px;box-shadow:0 2px 10px rgba(0,0,0,.04);padding:16px}

    .flex{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}

    .progress{height:10px;background:#f1f5f9;border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0;background:linear-gradient(90deg,var(--brand),#e85858);transition:width .3s ease}
    .hint{color:var(--muted);font-size:12px}

    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:16px}
    @media(max-width:560px){.grid{grid-template-columns:repeat(3,1fr);gap:8px}}

    .stamp{
      position:relative; aspect-ratio:1/1; border:2px dashed #cbd5e1; border-radius:12px; background:#fff; display:grid; place-items:center; cursor:pointer; overflow:hidden;
      transition:transform .08s ease; touch-action:manipulation; padding:6px; text-align:center
    }
    .stamp:active{transform:scale(.98)}
    .stamp[data-checked="true"]{border:2px solid var(--brand)}
    .emoji{font-size:26px; line-height:1}
    .label{font-size:11px;color:#475569;margin-top:6px}
    .idx{position:absolute;top:6px;left:8px;font-size:11px;color:#94a3b8}

    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}
    button, .btn{appearance:none;border:1px solid var(--line);background:#fff;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:600}
    .primary{background:linear-gradient(135deg,var(--brand),#e85858);color:#fff;border-color:transparent}
    .ghost{background:#f8fafc}

    .reward{margin-top:18px;border:1px dashed var(--gold);border-radius:12px;padding:14px;background:linear-gradient(180deg,rgba(207,174,92,.08),transparent)}
    .reward h3{margin:0 0 6px}
    .hide{display:none}

    .toast{position:fixed;left:50%;bottom:22px;transform:translateX(-50%) translateY(20px);opacity:0;transition:all .25s ease;background:#111827;color:#fff;padding:10px 14px;border-radius:999px;font-size:14px;box-shadow:0 6px 20px rgba(0,0,0,.3);z-index:9999}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

    .form{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:8px}
    .form input{padding:10px 12px;border:1px solid var(--line);border-radius:10px;font-size:14px;min-width:240px}
    .form .ok{color:var(--ok);font-size:12px}
    .form .warn{color:var(--warn);font-size:12px}

    /* ì¸ì‡„ìš© */
    @media print{
      header{position:static}
      .actions, .toast, .form{display:none!important}
      body{background:#fff}
      .stamp{border-color:#00000055}
    }
  </style>
</head>
<body>
  <header>
    <div class="head">
      <div class="badge">LCQ</div>
      <div>
        <div class="title">ìŠ¤íƒ¬í”„ ì¹´ë“œ â€” 12ê°„ì§€</div>
        <div class="sub">ì „í™”ë²ˆí˜¸ë¡œ ì ë¦½ ìƒíƒœ ë§¤í•‘ Â· 12ì¹¸ ì™„ë£Œ ì‹œ ë¦¬ì›Œë“œ</div>
      </div>
    </div>
  </header>

  <main>
    <section class="card" aria-labelledby="titleProgress">
      <div class="row" style="justify-content:space-between">
        <div>
          <strong id="titleProgress">ì ë¦½ í˜„í™©</strong>
          <div class="hint" id="progressHint">0/12 ì ë¦½</div>
        </div>
        <div class="hint" id="dateHint"></div>
      </div>

      <!-- ì „í™”ë²ˆí˜¸ ë§¤í•‘ ì˜ì—­ -->
      <div class="form" role="group" aria-label="ì „í™”ë²ˆí˜¸ ë§¤í•‘">
        <label for="phone" class="hint">ì „í™”ë²ˆí˜¸</label>
        <input id="phone" type="tel" placeholder="010-1234-5678" inputmode="numeric" autocomplete="tel" />
        <button id="bindBtn" class="btn">ì—°ë™/ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <span id="bindState" class="hint"></span>
      </div>

      <div class="progress" aria-hidden="true" style="margin-top:12px"><div class="bar" id="bar"></div></div>

      <div class="grid" id="grid" role="group" aria-label="12ê°„ì§€ ìŠ¤íƒ¬í”„">
        <!-- 12ì¹¸ ìë™ ìƒì„± -->
      </div>

      <div class="actions" role="group" aria-label="ì¡°ì‘">
        <button class="ghost" id="undoBtn" title="ë§ˆì§€ë§‰ ìŠ¤íƒ¬í”„ ë˜ëŒë¦¬ê¸°">â†© ë˜ëŒë¦¬ê¸°</button>
        <button class="ghost" id="resetBtn" title="ì´ˆê¸°í™”">ğŸ§¹ ì´ˆê¸°í™”</button>
        <button class="primary" id="shareBtn" title="ì§„í–‰ìƒí™© ê³µìœ ">ê³µìœ í•˜ê¸°</button>
      </div>

      <div class="reward hide" id="rewardBox" aria-live="polite">
        <h3>ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! 12ê°œ ì ë¦½ ì™„ë£Œ</h3>
        <p>ë¦¬ì›Œë“œ: <strong>LCQ ì‹œê·¸ë‹ˆì²˜ ìŒë£Œ 1ì” ë¬´ë£Œ</strong> ë˜ëŠ” <strong>ë³‘ë§ˆìš©íŒë‹¤ ìŠ¤í‹°ì»¤íŒ©</strong> ì¤‘ íƒ1</p>
        <p class="hint">ì§ì› í™•ì¸ í›„ ì¦ì •í•©ë‹ˆë‹¤. (ì¿ í° ID: <span id="couponId"></span>)</p>
      </div>
    </section>
  </main>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    // ====== ì„¤ì • ======
    const ZODIAC = [
      {key:'rat',    emoji:'ğŸ€', name:'ì(ì¥)'},
      {key:'ox',     emoji:'ğŸ‚', name:'ì¶•(ì†Œ)'},
      {key:'tiger',  emoji:'ğŸ…', name:'ì¸(í˜¸)'},
      {key:'rabbit', emoji:'ğŸ‡', name:'ë¬˜(í† ë¼)'},
      {key:'dragon', emoji:'ğŸ‰', name:'ì§„(ìš©)'},
      {key:'snake',  emoji:'ğŸ', name:'ì‚¬(ë±€)'},
      {key:'horse',  emoji:'ğŸ', name:'ì˜¤(ë§)'},
      {key:'goat',   emoji:'ğŸ‘', name:'ë¯¸(ì–‘)'},
      {key:'monkey', emoji:'ğŸ’', name:'ì‹ (ì›ìˆ­ì´)'},
      {key:'rooster',emoji:'ğŸ“', name:'ìœ (ë‹­)'},
      {key:'dog',    emoji:'ğŸ•', name:'ìˆ (ê°œ)'},
      {key:'pig',    emoji:'ğŸ–', name:'í•´(ë¼ì§€)'}
    ];
    const N = ZODIAC.length; // 12
    const KEY_PREFIX = 'lcqStampCard12:'; // ì „í™”ë²ˆí˜¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤

    // ====== ìƒíƒœ ======
    let phone = '';
    let KEY = KEY_PREFIX + 'guest';
    let state = load(KEY) || { stamps: Array(N).fill(false), updatedAt: Date.now(), coupon: null, history: [] };

    // ====== ì—˜ë¦¬ë¨¼íŠ¸ ======
    const grid = document.getElementById('grid');
    const bar = document.getElementById('bar');
    const hint = document.getElementById('progressHint');
    const dateHint = document.getElementById('dateHint');
    const toast = document.getElementById('toast');
    const rewardBox = document.getElementById('rewardBox');
    const couponId = document.getElementById('couponId');
    const phoneInput = document.getElementById('phone');
    const bindBtn = document.getElementById('bindBtn');
    const bindState = document.getElementById('bindState');

    // ====== UI ë¹Œë“œ: 12ê°„ì§€ ì¹¸ ======
    function buildGrid(){
      grid.innerHTML='';
      ZODIAC.forEach((z, i)=>{
        const btn = document.createElement('button');
        btn.className = 'stamp';
        btn.setAttribute('aria-pressed','false');
        btn.setAttribute('title', `${z.name} ìŠ¤íƒ¬í”„`);
        btn.dataset.index = i;
        btn.innerHTML = `
          <span class="idx">${i+1}</span>
          <div class="emoji" aria-hidden="true">${z.emoji}</div>
          <div class="label">${z.name}</div>
        `;
        btn.addEventListener('click', ()=> toggle(i));
        grid.appendChild(btn);
      });
    }

    // ====== ì „í™”ë²ˆí˜¸ í¬ë§· & ë°”ì¸ë”© ======
    function normalizePhone(v){
      if(!v) return '';
      const digits = v.replace(/\D/g,'');
      if(digits.length < 9) return digits; // ë¶ˆì™„ì „
      // í•œêµ­ íœ´ëŒ€ì „í™” ê°„ë‹¨ í¬ë§· 3-4-4 ì‹œë„
      if(digits.startsWith('02')){
        return digits.replace(/(02)(\d{3,4})(\d{4})/, '$1-$2-$3');
      }
      return digits.replace(/(\d{3})(\d{3,4})(\d{4})/, '$1-$2-$3');
    }

    function bindPhone(){
      const formatted = normalizePhone(phoneInput.value.trim());
      phoneInput.value = formatted;
      if(!/\d{2,4}-\d{3,4}-\d{4}/.test(formatted)){
        bindState.textContent = 'ì „í™”ë²ˆí˜¸ í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”';
        bindState.className = 'warn';
        notify('ì „í™”ë²ˆí˜¸ í˜•ì‹ ì˜¤ë¥˜');
        return;
      }
      phone = formatted;
      KEY = KEY_PREFIX + phone;
      state = load(KEY) || { stamps: Array(N).fill(false), updatedAt: Date.now(), coupon: null, history: [] };
      save();
      render();
      bindState.textContent = `ì—°ë™ë¨: ${phone}`;
      bindState.className = 'ok';
      notify('ì „í™”ë²ˆí˜¸ ì—°ë™ ë° ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ');
    }

    bindBtn.addEventListener('click', bindPhone);
    phoneInput.addEventListener('change', ()=>{ phoneInput.value = normalizePhone(phoneInput.value) })

    // ====== ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ======
    function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }
    function load(key){ try{ return JSON.parse(localStorage.getItem(key)); }catch(e){ return null } }

    // ====== ìƒí˜¸ì‘ìš© ======
    function toggle(i){
      if(state.stamps[i]) return notify('ì´ë¯¸ ì°íŒ ì¹¸ì…ë‹ˆë‹¤');
      state.stamps[i] = true;
      state.history.push(i);
      state.updatedAt = Date.now();
      save();
      render();
      const done = count();
      notify(`${ZODIAC[i].name} ë„ì¥ ì ë¦½ â€” ${done}/${N}`);
      if(done===N) unlock();
    }

    function count(){ return state.stamps.filter(Boolean).length }

    function render(){
      // cells
      [...grid.children].forEach((el, i)=>{
        const checked = !!state.stamps[i];
        el.dataset.checked = checked;
        el.setAttribute('aria-pressed', checked? 'true':'false');
      });
      // progress
      const done = count();
      bar.style.width = (done/N*100)+'%';
      hint.textContent = `${done}/${N} ì ë¦½`;
      dateHint.textContent = `ì—…ë°ì´íŠ¸: ${new Date(state.updatedAt).toLocaleString()}`;
      // reward
      if(done===N){
        rewardBox.classList.remove('hide');
        if(!state.coupon){ state.coupon = genCoupon(); save(); }
        couponId.textContent = state.coupon;
      }else{
        rewardBox.classList.add('hide');
      }
    }

    function genCoupon(){
      // ê°„ë‹¨í•œ ë¡œì»¬ ì¿ í° ID (ì‹¤ìš´ì˜ì€ ì„œë²„ ë°œê¸‰ ê¶Œì¥)
      const rnd = Math.random().toString(36).slice(2,8).toUpperCase();
      const day = new Date().toISOString().slice(2,10).replace(/-/g,'');
      return `LCQ12-${day}-${rnd}`;
    }

    function notify(msg){
      const t = document.getElementById('toast');
      t.textContent = msg; t.classList.add('show');
      clearTimeout(window.__t); window.__t = setTimeout(()=> t.classList.remove('show'), 1600);
    }

    document.getElementById('undoBtn').addEventListener('click',()=>{
      const last = state.history.pop();
      if(last==null){ return notify('ë˜ëŒë¦´ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤'); }
      state.stamps[last] = false; state.updatedAt = Date.now(); save(); render(); notify('ë§ˆì§€ë§‰ ìŠ¤íƒ¬í”„ ì·¨ì†Œ');
    });

    document.getElementById('resetBtn').addEventListener('click',()=>{
      if(!confirm('ëª¨ë“  ìŠ¤íƒ¬í”„ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”? í˜„ì¬ ì „í™”ë²ˆí˜¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œë§Œ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.')) return;
      state.stamps = Array(N).fill(false); state.history = []; state.coupon = null; state.updatedAt = Date.now(); save(); render(); notify('ì´ˆê¸°í™” ì™„ë£Œ');
    });

    document.getElementById('shareBtn').addEventListener('click', async ()=>{
      const done = count();
      const text = `LCQ 12ê°„ì§€ ìŠ¤íƒ¬í”„ ${done}/${N} ì ë¦½` + (done===N? ` â€” ì¿ í°: ${state.coupon}`:'' ) + (phone? ` â€” ${phone}`:'' );
      try{
        if(navigator.share){ await navigator.share({title:'LCQ Stamp 12', text}); }
        else { await navigator.clipboard.writeText(text); notify('ì§„í–‰ìƒí™©ì„ í´ë¦½ë³´ë“œì— ë³µì‚¬í–ˆìŠµë‹ˆë‹¤'); return; }
        notify('ê³µìœ  ì™„ë£Œ');
      }catch(e){ notify('ê³µìœ ê°€ ì·¨ì†Œë˜ì—ˆì–´ìš”'); }
    });

    function unlock(){
      notify('12ê°œ ì ë¦½ ì™„ë£Œ! ë¦¬ì›Œë“œë¥¼ ë°›ì•„ê°€ì„¸ìš”');
      rewardBox.animate([
        { transform:'scale(.98)', filter:'brightness(.98)' },
        { transform:'scale(1.02)', filter:'brightness(1.05)' },
        { transform:'scale(1)', filter:'brightness(1)' }
      ], { duration:500, easing:'cubic-bezier(.2,.8,.2,1)' });
    }

    // ì´ˆê¸° ë¹Œë“œ ë° ë Œë”
    buildGrid();
    render();
  </script>
</body>
</html>
