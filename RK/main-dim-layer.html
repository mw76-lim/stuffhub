<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>딤레이어 공지 팝업 (800×600 이미지)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --popup-w: 800px; /* 기본 너비(이미지 폭과 동일) */
      --radius: 16px;
      --shadow: 0 20px 50px rgba(0,0,0,.35);
      --brand: #0a68ff;
    }
    html,body{ height:100%; margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif; }
    body.has-modal{ overflow:hidden; }

    /* Dim overlay */
    .dimlayer{
      position:fixed; inset:0; z-index:1000;
      display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,.55);
      -webkit-backdrop-filter:saturate(1.1) blur(2px);
      backdrop-filter:saturate(1.1) blur(2px);
    }
    .dimlayer[aria-hidden="true"]{ display:none; }

    /* Popup card */
    .notice{
      width:var(--popup-w);
      background:#fff; border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden; transform:translateY(8px); opacity:0;
      animation: pop .28s ease-out forwards;
      position: relative;
    }
    @keyframes pop { to { transform:translateY(0); opacity:1; } }

    /* Header (X button) */
    .notice__bar{
      position:absolute; inset:8px 8px auto auto;
      display:flex; gap:8px; z-index:2;
    }
    .iconbtn{
      appearance:none; border:0; background:#fff; color:#111;
      width:36px; height:36px; border-radius:999px;
      box-shadow:0 2px 10px rgba(0,0,0,.15);
      display:grid; place-items:center; cursor:pointer;
    }
    .iconbtn:hover{ background:#f5f7fb; }
    .iconbtn:focus-visible{ outline:3px solid rgba(10,104,255,.35); }

    /* Image content: 데스크톱에서 800×600 고정 */
    .notice__img{
      display:block;
      width:800px;
      height:600px;
      object-fit:cover;
      background:#00000008;
    }

    /* Footer controls */
    .notice__foot{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; padding:12px 14px; background:#f7f9fc; border-top:1px solid #e9eef7;
    }
    .chk{ display:flex; align-items:center; gap:8px; font-size:.95rem; color:#333; }
    .chk input{ width:18px; height:18px; }
    .btn{ appearance:none; border:0; cursor:pointer; padding:10px 16px; border-radius:10px; font-weight:600; }
    .btn--primary{ background:var(--brand); color:#fff; }
    .btn--primary:hover{ filter:brightness(.95); }
    .btn--ghost{ background:transparent; color:#111; }
    .btn--ghost:hover{ background:#e9eef7; }

    /* Mobile: 작은 화면에서는 비율 유지하며 축소 표시 */
    @media (max-width: 840px){
      :root{ --popup-w: 94vw; }
      .notice__img{
        width:100%;
        height:auto;
        aspect-ratio: 4 / 3; /* 800×600 비율 유지 */
      }
      .notice__foot{ flex-direction:column; align-items:stretch; }
    }
  </style>
</head>
<body>

  <!-- 페이지 콘텐츠 -->
  <main style="min-height:120vh; display:grid; place-items:center; text-align:center; padding:24px;">
    <h1 style="margin:0 0 8px;">메인 페이지</h1>
    <p style="margin:0 0 18px;">아래 버튼으로 팝업을 테스트하세요.</p>
    <button class="btn btn--primary" id="openBtn" type="button">공지 팝업 열기</button>
  </main>

  <!-- 딤레이어 팝업 -->
  <div class="dimlayer" id="dim" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="noticeTitle">
    <div class="notice" role="document">
      <!-- 닫기 버튼 -->
      <div class="notice__bar">
        <button class="iconbtn" id="closeX" aria-label="닫기">
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>

      <!-- 공지 이미지 (요청하신 800×600 / 지정 URL) -->
      <div class="notice__link" >
        <img
          class="notice__img"
          src="https://placehold.co/800x600/000000/FFFFFF/png?text=Image+,+on/off"
          width="800" height="600"
          alt="공지 배너 이미지 (800×600)" />
      </div>
      <h2 id="noticeTitle" style="position:absolute; left:-9999px; top:auto;">공지 팝업</h2>

      <!-- 풋터: 오늘 하루 보지 않기 + 닫기/자세히 -->
      <div class="notice__foot">
        <label class="chk">
          <input type="checkbox" id="hideToday" />
          오늘 하루 보지 않기
        </label>
        <div class="btn--row">
          <button class="btn btn--ghost" id="closeBtn" type="button">닫기</button>
          <button class="btn btn--primary" id="goBtn" type="button">자세히 보기</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const STORAGE_KEY = 'rk_notice_hide_until';
      const dim = document.getElementById('dim');
      const openBtn = document.getElementById('openBtn');
      const closeBtn = document.getElementById('closeBtn');
      const closeX = document.getElementById('closeX');
      const goBtn = document.getElementById('goBtn');
      const hideToday = document.getElementById('hideToday');
      let lastFocus = null;

      function endOfToday(){
        const now = new Date();
        return new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59, 999).getTime();
      }
      function shouldOpen(){
        const until = Number(localStorage.getItem(STORAGE_KEY) || 0);
        return Date.now() > until;
      }
      function lockScroll(lock){
        document.body.classList.toggle('has-modal', !!lock);
      }
      function openNotice(){
        lastFocus = document.activeElement;
        dim.setAttribute('aria-hidden','false');
        lockScroll(true);
        closeX.focus();
        // 간단 포커스 트랩
        const focusables = dim.querySelectorAll('button, [href], input, [tabindex]:not([tabindex="-1"])');
        const first = focusables[0], last = focusables[focusables.length - 1];
        dim.addEventListener('keydown', function(e){
          if(e.key === 'Escape'){ e.preventDefault(); closeNotice(); }
          if(e.key === 'Tab'){
            if(e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
            else if(!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
          }
        });
      }
      function closeNotice(){
        if(hideToday.checked){
          localStorage.setItem(STORAGE_KEY, String(endOfToday()));
        }
        dim.setAttribute('aria-hidden','true');
        lockScroll(false);
        if(lastFocus && typeof lastFocus.focus === 'function') lastFocus.focus();
      }

      // 바깥 클릭 닫기
      dim.addEventListener('click', (e)=>{ if(e.target === dim) closeNotice(); });

      openBtn.addEventListener('click', openNotice);
      closeBtn.addEventListener('click', closeNotice);
      closeX.addEventListener('click', closeNotice);

      // 자세히 보기 (이미지 링크와 동일 동작)
      goBtn.addEventListener('click', ()=>{
        const link = document.querySelector('.notice__link');
        if(link && link.getAttribute('href') && link.getAttribute('href') !== '#'){
          window.open(link.href, link.target || '_blank', 'noopener');
        }
        closeNotice();
      });

      // 첫 방문/하루 지나면 자동 오픈
      document.addEventListener('DOMContentLoaded', ()=>{
        if(shouldOpen()) openNotice();
      });
    })();
  </script>
</body>
</html>
