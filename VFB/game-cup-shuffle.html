<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ì»µ ì…”í”Œ ì•¼ë°”ìœ„ ê²Œì„ (ê³µ ìœ„ì¹˜ ê³µê°œ ë²„ì „)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f7f2ea;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        color: #3a2415;
      }

      .game-shell {
        width: 100%;
        max-width: 720px;
        padding: 32px 28px 30px;
        background: #fffaf5;
        border-radius: 24px;
        border: 1px solid rgba(193, 160, 120, 0.5);
        box-shadow: 0 16px 40px rgba(120, 72, 37, 0.18);
      }

      .game-header {
        text-align: center;
        margin-bottom: 20px;
      }

      .game-title {
        font-size: 22px;
        font-weight: 800;
        letter-spacing: -0.02em;
        margin-bottom: 4px;
      }

      .game-sub {
        font-size: 13px;
        color: #6b4a30;
      }

      .table-area {
        margin-top: 12px;
        padding: 20px 16px 18px;
        border-radius: 18px;
        background: radial-gradient(circle at top, #f4e5d4, #e2c7a8);
        box-shadow: inset 0 3px 8px rgba(255, 255, 255, 0.7);
        position: relative;
        overflow: hidden;
      }

      .cup-stage {
        position: relative;
        height: 220px;
      }

      .cup {
        position: absolute;
        bottom: 30px;
        width: 90px;
        height: 110px;
        border-radius: 60px 60px 16px 16px;
        background: linear-gradient(
          180deg,
          #f9f5ef 0,
          #f1e0cd 40%,
          #e2c4a0 100%
        );
        box-shadow:
          0 10px 18px rgba(124, 78, 38, 0.4),
          inset 0 0 0 1px rgba(255, 255, 255, 0.6);
        transform: translateX(-50%);
        transition: left 0.32s ease, transform 0.18s ease;
        cursor: pointer;
      }

      .cup::before {
        content: "";
        position: absolute;
        top: -10px;
        left: 50%;
        transform: translateX(-50%);
        width: 70px;
        height: 12px;
        border-radius: 999px;
        background: radial-gradient(circle at top, #ffffff, #e8d6c0);
        box-shadow: 0 2px 4px rgba(124, 78, 38, 0.25);
      }

      .cup::after {
        content: "";
        position: absolute;
        bottom: -6px;
        left: 50%;
        transform: translateX(-50%);
        width: 74px;
        height: 10px;
        border-radius: 999px;
        background: rgba(111, 70, 33, 0.45);
        filter: blur(3px);
        opacity: 0.9;
      }

      .cup.is-disabled {
        cursor: default;
        opacity: 0.7;
      }

      .cup.is-highlight {
        box-shadow:
          0 12px 24px rgba(201, 93, 39, 0.6),
          inset 0 0 0 1px rgba(255, 255, 255, 0.7);
      }

      .cup.reveal {
        transform: translate(-50%, -20px);
      }

      .ball {
        position: absolute;
        bottom: 30px;
        width: 26px;
        height: 26px;
        border-radius: 50%;
        background: radial-gradient(circle at 30% 20%, #ffffff, #e11d48);
        box-shadow:
          0 0 0 3px rgba(120, 46, 60, 0.6),
          0 6px 10px rgba(120, 46, 60, 0.7);
        transform: translateX(-50%);
        opacity: 0;
        transition: left 0.32s ease, opacity 0.2s ease;
        pointer-events: none;
      }

      .ball.visible {
        opacity: 1;
      }

      .status-row {
        margin-top: 16px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        justify-content: space-between;
        font-size: 13px;
      }

      .status-text {
        color: #6b4a30;
      }

      .status-text strong {
        color: #b45309;
      }

      .btn {
        border-radius: 999px;
        padding: 9px 18px;
        font-size: 13px;
        border: 1px solid rgba(148, 104, 63, 0.7);
        background: #fff;
        color: #3a2415;
        font-weight: 600;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: 0.15s ease;
      }

      .btn.primary {
        background: linear-gradient(120deg, #f97316, #fbbf24);
        border-color: transparent;
        color: #3b1f0a;
        box-shadow: 0 10px 24px rgba(201, 93, 39, 0.5);
      }

      .btn:hover:not([disabled]) {
        transform: translateY(-1px);
        box-shadow: 0 12px 26px rgba(201, 93, 39, 0.55);
      }

      .btn:active:not([disabled]) {
        transform: translateY(0);
        box-shadow: none;
      }

      .btn[disabled] {
        opacity: 0.6;
        cursor: default;
        box-shadow: none;
      }

      .hint {
        margin-top: 8px;
        font-size: 11px;
        color: #8b6544;
      }

      @media (max-width: 640px) {
        .game-shell {
          padding: 20px 16px 22px;
        }

        .cup-stage {
          height: 200px;
        }

        .cup {
          width: 80px;
          height: 100px;
        }
      }
    </style>
  </head>
  <body>
    <div class="game-shell">
      <header class="game-header">
        <h1 class="game-title">ì»µ ì…”í”Œ ì•¼ë°”ìœ„ ê²Œì„</h1>
        <p class="game-sub">
          ì„ê¸° ì „ì— ê³µ ìœ„ì¹˜ë¥¼ ì ê¹ ë³´ì—¬ë“œë¦½ë‹ˆë‹¤. ì˜ ê¸°ì–µí•´ë‘ì…¨ë‹¤ê°€, ì„ê¸° í›„ ê³µì´ ë“¤ì–´ìˆëŠ” ì»µì„ ë§ì¶°ë³´ì„¸ìš”!
        </p>
      </header>

      <section class="table-area">
        <div class="cup-stage">
          <!-- ì»µ 3ê°œ -->
          <div class="cup" data-id="0"></div>
          <div class="cup" data-id="1"></div>
          <div class="cup" data-id="2"></div>
          <!-- ì •ë‹µ ê³µ -->
          <div class="ball" id="ball"></div>
        </div>

        <div class="status-row">
          <div class="status-text" id="statusText">
            <strong>ì„ê¸° ì‹œì‘í•˜ê¸°</strong> ë²„íŠ¼ì„ ëˆ„ë¥´ë©´, ë¨¼ì € ê³µì˜ ìœ„ì¹˜ë¥¼ ì ê¹ ê³µê°œí•©ë‹ˆë‹¤.
          </div>
          <button type="button" class="btn primary" id="startButton">
            ì„ê¸° ì‹œì‘í•˜ê¸° ğŸ©
          </button>
        </div>

        <p class="hint">
          * ì‹¤ì œ ì´ë²¤íŠ¸ì—ì„œëŠ” ì •ë‹µ ì‹œ ì¿ í°/ì„œë¹„ìŠ¤ ì œê³µ ì •ì±…ì„ ì—°ë™í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
        </p>
      </section>
    </div>

    <script>
      (function () {
        const cups = document.querySelectorAll(".cup");
        const ball = document.getElementById("ball");
        const startButton = document.getElementById("startButton");
        const statusText = document.getElementById("statusText");

        // ìŠ¬ë¡¯ ìœ„ì¹˜: ì™¼, ê°€ìš´ë°, ì˜¤ë¥¸ìª½
        const slotPositions = ["20%", "50%", "80%"];

        let winningCupId = null; // ê³µì´ ë“¤ì–´ìˆëŠ” ì»µ ID(0,1,2)
        let isShuffling = false;
        let canPick = false;

        // ìŠ¬ë¡¯ ì¸ë±ìŠ¤ -> ì»µ ID ë§¤í•‘ (ì´ˆê¸°: 0,1,2)
        let slotToCup = [0, 1, 2];

        function initPositions() {
          cups.forEach((cup, idx) => {
            cup.style.left = slotPositions[idx];
            cup.classList.remove(
              "reveal",
              "is-disabled",
              "is-highlight"
            );
          });
          ball.classList.remove("visible");
        }

        function resetGameState() {
          isShuffling = false;
          canPick = false;
          slotToCup = [0, 1, 2];
          initPositions();
          statusText.innerHTML =
            "<strong>ì„ê¸° ì‹œì‘í•˜ê¸°</strong> ë²„íŠ¼ì„ ëˆ„ë¥´ë©´, ë¨¼ì € ê³µì˜ ìœ„ì¹˜ë¥¼ ì ê¹ ê³µê°œí•©ë‹ˆë‹¤.";
          startButton.textContent = "ì„ê¸° ì‹œì‘í•˜ê¸° ğŸ©";
        }

        // ê³µ ìœ„ì¹˜ ì ê¹ ë³´ì—¬ì£¼ê¸°
        function revealBallThenShuffle() {
          // 1) ëœë¤ìœ¼ë¡œ ê³µì´ ë“¤ì–´ìˆëŠ” ì»µ ì„ íƒ
          winningCupId = Math.floor(Math.random() * 3);
          const winningCupEl = document.querySelector(
            `.cup[data-id="${winningCupId}"]`
          );

          // í˜„ì¬ ì»µ ìœ„ì¹˜(ì´ˆê¸° ìƒíƒœ: slotToCupì™€ 1:1 ë§¤ì¹­)
          const leftPos = winningCupEl.style.left || slotPositions[winningCupId];
          ball.style.left = leftPos;

          // ì»µ ë“¤ê³  ê³µ ë³´ì—¬ì£¼ê¸°
          winningCupEl.classList.add("reveal", "is-highlight");
          ball.classList.add("visible");

          statusText.innerHTML =
            "ğŸ‘€ ê³µ ìœ„ì¹˜ë¥¼ ê¸°ì–µí•˜ì„¸ìš”! ì ì‹œ í›„ ì»µì„ ì„ìŠµë‹ˆë‹¤...";

          // 1.2ì´ˆ í›„ ê³µ ìˆ¨ê¸°ê³  ì»µ ë‹¤ì‹œ ë‚´ë¦° ë’¤ ì…”í”Œ ì‹œì‘
          setTimeout(() => {
            ball.classList.remove("visible");

            setTimeout(() => {
              winningCupEl.classList.remove("reveal");
              setTimeout(() => {
                winningCupEl.classList.remove("is-highlight");
              }, 120);

              // ì´ì œ ì§„ì§œ ì„ê¸° ì‹œì‘
              startShuffling();
            }, 200);
          }, 1200);
        }

        // ì‹¤ì œ ì»µ ì…”í”Œ ë¡œì§
        function startShuffling() {
          isShuffling = true;
          canPick = false;
          startButton.disabled = true;
          statusText.innerHTML = "ì„ëŠ” ì¤‘ì…ë‹ˆë‹¤... ëˆˆì„ ë–¼ì§€ ë§ˆì„¸ìš” ğŸ‘€";

          const totalSwaps = 8;
          let step = 0;

          function doSwap() {
            if (step >= totalSwaps) {
              // ì„ê¸° ì¢…ë£Œ
              isShuffling = false;
              canPick = true;
              startButton.disabled = false;
              startButton.textContent = "ë‹¤ì‹œ ì„ê¸° ğŸ”";
              statusText.innerHTML =
                "ì–´ë””ì— ìˆ¨ì—ˆì„ê¹Œìš”? ê³µì´ ë“¤ì–´ìˆë‹¤ê³  ìƒê°ë˜ëŠ” ì»µ í•˜ë‚˜ë¥¼ ì„ íƒí•´ë³´ì„¸ìš”.";
              cups.forEach((cup) => cup.classList.remove("is-disabled"));
              return;
            }

            // ì„œë¡œ ë‹¤ë¥¸ ë‘ ìŠ¬ë¡¯ ì„ íƒ
            let s1 = Math.floor(Math.random() * 3);
            let s2;
            do {
              s2 = Math.floor(Math.random() * 3);
            } while (s2 === s1);

            const cupId1 = slotToCup[s1];
            const cupId2 = slotToCup[s2];

            const cupEl1 = document.querySelector(`.cup[data-id="${cupId1}"]`);
            const cupEl2 = document.querySelector(`.cup[data-id="${cupId2}"]`);

            // ì‚´ì§ ë“¤ì–´ì˜¬ë ¸ë‹¤ê°€ êµí™˜
            cupEl1.style.transform = "translate(-50%, -12px)";
            cupEl2.style.transform = "translate(-50%, -12px)";

            setTimeout(() => {
              cupEl1.style.left = slotPositions[s2];
              cupEl2.style.left = slotPositions[s1];
            }, 80);

            setTimeout(() => {
              cupEl1.style.transform = "translate(-50%, 0)";
              cupEl2.style.transform = "translate(-50%, 0)";
            }, 220);

            // ë§¤í•‘ ê°±ì‹ : ìŠ¬ë¡¯ì— ë“¤ì–´ìˆëŠ” ì»µ ID êµí™˜
            const temp = slotToCup[s1];
            slotToCup[s1] = slotToCup[s2];
            slotToCup[s2] = temp;

            step++;
            setTimeout(doSwap, 320);
          }

          cups.forEach((cup) => {
            cup.classList.add("is-disabled");
          });

          setTimeout(doSwap, 300);
        }

        // ê²°ê³¼ ê³µê°œ
        function revealResult(chosenId) {
          canPick = false;
          startButton.disabled = false;

          const winningCupEl = document.querySelector(
            `.cup[data-id="${winningCupId}"]`
          );

          const winningLeft =
            winningCupEl.style.left ||
            slotPositions[
              slotToCup.indexOf(winningCupId) >= 0
                ? slotToCup.indexOf(winningCupId)
                : 1
            ];

          ball.style.left = winningLeft;
          winningCupEl.classList.add("reveal", "is-highlight");
          ball.classList.add("visible");

          cups.forEach((cup) => {
            if (parseInt(cup.dataset.id, 10) !== winningCupId) {
              cup.classList.add("is-disabled");
            }
          });

          if (chosenId === winningCupId) {
            statusText.innerHTML =
              "ğŸ‰ <strong>ì •ë‹µ!</strong> ê³µì´ ë“¤ì–´ìˆë˜ ì»µì„ ì •í™•íˆ ë§ì¶”ì…¨ìŠµë‹ˆë‹¤.";
          } else {
            statusText.innerHTML =
              "ğŸ˜¢ ì•„ì‰½ìŠµë‹ˆë‹¤! ì„ íƒí•˜ì‹  ì»µì—ëŠ” ê³µì´ ì—†ì—ˆì–´ìš”. ì •ë‹µ ì»µì„ í™•ì¸í•´ë³´ì„¸ìš”.";
          }
        }

        // ì»µ í´ë¦­
        cups.forEach((cup) => {
          cup.addEventListener("click", () => {
            if (!canPick || isShuffling) return;
            const id = parseInt(cup.dataset.id, 10);
            revealResult(id);
          });
        });

        // ì‹œì‘ ë²„íŠ¼
        startButton.addEventListener("click", () => {
          if (isShuffling) return;
          resetGameState();          // ê¸°ë³¸ ìƒíƒœ ì„¸íŒ…
          startButton.disabled = true;
          revealBallThenShuffle();   // ê³µ ë¨¼ì € ë³´ì—¬ì£¼ê³  ì…”í”Œ ì‹œì‘
        });

        // ìµœì´ˆ ë ˆì´ì•„ì›ƒ ì„¸íŒ…
        initPositions();
      })();
    </script>
  </body>
</html>
